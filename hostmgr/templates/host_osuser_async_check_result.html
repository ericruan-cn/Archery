{% extends "base.html" %}
{% block content %}

    <!-- 内容 -->
    <!-- 内容区域 -->
    <div class="content-wrapper">

        <!-- 内容头部 -->
        <section class="content-header">
            <!--
            <h1>
                主机管理
                <small>主机维护</small>
            </h1>
            -->
            <ol class="breadcrumb">
                <li><a href="/dashboard/"><i class="fa fa-dashboard"></i> 首页</a></li>
                <li><a href="#">主机管理</a></li>
                <li class="active">LINUX账号核验</li>
            </ol>
        </section>
        <!-- 内容头部/ -->

        <!-- 正文区域 -->
        <section class="content">


            <!-- .box-body -->
            <div class="box box-primary">
                <div class="box-body">
                    <!-- 数据表格 -->

                    <div class="table-box table-responsive">

                        <h4> 任务状态: {{ cache_task_result.status }}, 开始时间: {{ cache_task_result.start_time }}{% if cache_task_result.status == 'finish' %}, 结束时间: {{ cache_task_result.end_time }} {% endif %}
                        </h4>
                        <input type="hidden" id="task_status" name="task_status" value="{{ cache_task_result.status }}">

                        <!--数据列表-->
                        <table id="dataList" data-toggle="table"
                               class="table table-bordered table-striped table-hover dataTable"
                               style="table-layout:inherit;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
                            <thead>
                            <tr>
                                <!-- ipaddr,sshport,username,password,type,check_result -->
                                <th>序号</th>
                                <th>IP</th>
                                <th>SSH端口</th>
                                <th>用户</th>
                                <th>密码</th>
                                <th>账号类型</th>
                                <th>验证结果</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for row in cache_task_detail %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ row.ipaddr }}</td>
                                    <td>{{ row.sshport }}</td>
                                    <td>{{ row.username }}</td>
                                    <td>
                                        {% if row.check_result == '待验证' %}
                                            {{ row.password }}
                                        {% elif row.check_result == '登陆成功，校验通过!' %}
                                            &nbsp;
                                        {% else %}
                                            {{ row.password }}
                                        {% endif %}
                                    </td>
                                    <td>{{ row.type }} </td>
                                    <td>
                                        {% if row.check_result == '待验证' %}
                                            {{ row.check_result }}
                                        {% elif row.check_result == '登陆成功，校验通过!' %}
                                            <span style="color: darkgreen;"> {{ row.check_result }} </span>
                                        {% else %}
                                            <span style="color: darkred;"> {{ row.check_result }} </span>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        <!--数据列表-->
                    </div>
                    <!-- 数据表格 -->
                </div>
                <!-- .box-body -->
            </div>
        </section>
        <!-- 正文区域 /-->
    </div>
{% endblock content %}

{% block js %}
    {% load static %}
    <script>
        // 每5秒刷新页面
        setInterval(function () {
            if ($('#task_status').val() === "running") {
                window.location.reload();
            }
        }, 5000);
    </script>
{% endblock %}
